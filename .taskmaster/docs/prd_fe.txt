# Overview
FixingApp Frontend is a web application that connects **employers** needing home/field services (plumbing, electrical, carpentry, etc.) with **workers** who can perform those jobs.  
The frontend’s job is to provide a fast, intuitive, mobile‑friendly experience for:
- Discovering and posting jobs
- Matching workers to jobs
- Managing applications, handover, reviews, complaints, notifications

It sits on top of an existing Node.js/Express + SQLite backend and exposes all capabilities of the backend through a modern, Chợ Tốt–inspired UI. The primary value is reducing friction for both sides (employers and workers) while enforcing all backend business rules clearly in the interface.

---

# Core Features

## 1. Global Layout & Navigation

**What it does**  
Provides a persistent shell (header, footer, main content) with clear entry points for workers, employers, and admins.

**Why it’s important**  
Users must always know where they are, how to search for jobs, how to post jobs, and how to access their dashboard and notifications.

**How it works (high level)**  
- Header includes:
  - Logo → `/`
  - Main nav: `Tìm việc làm` → `/jobs`, `Tìm thợ sửa chữa/Đăng việc` → `/jobs/new`, `Trang của tôi` → `/dashboard`
  - Auth area: `Đăng nhập` / `Đăng ký` for guests; avatar + dropdown for logged‑in users.
  - Notification bell tied to `/notifications`.
- Footer contains support links, policies, and app download promotion (optional).
- On load, frontend calls `GET /api/users/me` to determine session and role; header adapts to EMPLOYER / WORKER / ADMIN vs guest.

## 2. Authentication & User Management

**What it does**  
Allows users to register as **employer** or **worker**, log in, and manage their profile.

**Why it’s important**  
Roles drive what users can see/do (post jobs vs apply to jobs, admin tools). Good auth UX is necessary for trust and retention.

**How it works (high level)**  
- Registration:
  - Employer: `POST /api/auth/register-employer` with `phone`, `password`, `fullName`, `address`.
  - Worker: `POST /api/auth/register-worker` with `phone`, `password`, `fullName`, `address`, `skill`.
  - On success, backend returns `{ token, user }`; frontend stores token (localStorage) and user (global auth store) and routes to appropriate dashboard.
- Login:
  - `POST /api/auth/login` with `phone`, `password`, same `{ token, user }` response.
  - Frontend uses role to route to `/dashboard/employer`, `/dashboard/worker`, or `/dashboard/admin`.
- Profile:
  - `GET /api/users/me` to fetch current user (and profile).
  - `PUT /api/users/me` to update `fullName` and `address`.
- All authenticated requests attach `Authorization: Bearer <token>` via a shared HTTP client.

## 3. Job Discovery & Search

**What it does**  
Enables workers and guests to discover open jobs, filter by skill/price/location/status, and browse job details.

**Why it’s important**  
This is the primary worker entrypoint and the main way jobs get matched with workers.

**How it works (high level)**  
- Home hero and search bar:
  - Keyword search (`q`).
  - Skill dropdown (`skill`).
  - Location selector (`city`, `district`).
  - On submit, navigate to `/jobs` and call `GET /api/jobs` with corresponding query params.
- Jobs listing (`/jobs`):
  - Calls `GET /api/jobs` with:
    - `q`, `skill`, `status`, `city`, `district`, `minPrice`, `maxPrice`, `sort`, `page`, `limit`.
  - Displays cards in a grid, with pagination or “Xem thêm”.
- Feed tabs:
  - “Dành cho bạn”: for workers, uses worker’s `skill` from `GET /api/users/me` and calls `GET /api/jobs?skill=<skill>&status=CHUA_LAM`.
  - “Mới nhất”: `GET /api/jobs?sort=createdAt_desc`.
  - “Gần bạn”: `GET /api/jobs?city=<city>&district=<district>` after user selects region.
- Empty and loading states use skeletons and friendly messages when no results.

## 4. Job Detail, Applications & Status Management

**What it does**  
Shows a full job page and supports:
- Workers applying to jobs
- Employers managing applications (accept/reject)
- Employers managing job status (complete/reset)

**Why it’s important**  
Job detail is where decisions happen; it must represent backend rules clearly (e.g., no applying to completed jobs, employer can’t apply to their own job).

**How it works (high level)**  
- Job detail (`/jobs/[id]`):
  - Fetches `GET /api/jobs/:jobId` to show title, description, price, address, requiredSkill, status, createdAt, handoverDeadline, acceptedWorkerId.
  - Worker actions:
    - `Ứng tuyển ngay` → `POST /api/jobs/:jobId/apply` (body may include `note`).
    - Handles business rule errors (already applied, job completed, employer trying to apply) by displaying backend `error` text.
  - Employer actions:
    - Applications panel:
      - `GET /api/jobs/:jobId/applications` (or `GET /api/applications?jobId=...`) to list workers, skills, ratings, application status, createdAt.
      - Accept/reject via `POST /api/applications/:applicationId/accept` and `/reject`.
    - Job status:
      - `POST /api/jobs/:jobId/complete` and `POST /api/jobs/:jobId/reset`.
      - Optionally `GET /api/jobs/:jobId/status` to show current status and handoverDeadline.

## 5. Worker Experience (Dashboard, Certificates, Reviews)

**What it does**  
Gives workers a view of:
- Jobs they applied to
- Jobs they are currently handling or finished
- Their verification status and certificates
- Reviews they have received

**Why it’s important**  
Workers need a clear picture of their pipeline and reputation, which influences future job matches.

**How it works (high level)**  
- Worker dashboard (`/dashboard/worker`):
  - Uses `GET /api/users/me` to confirm role and get worker id.
  - Uses `GET /api/applications/my` with optional `status` filter to show:
    - PENDING, ACCEPTED, REJECTED applications, joined with job info.
  - Uses `GET /api/reviews/worker/:workerId` to compute and display average rating and review list.
- Certificates & verification (`/certificates`):
  - `GET /api/workers/certificates/status` → `{ isVerified, certificates[] }`.
  - Upload new certificate via `POST /api/workers/certificates` with `imageUrl`.
  - Admin approves/rejects via admin APIs; worker UI reflects updated `isVerified` on next refresh.
- Worker profile (`/workers/[id]`):
  - Shows reviews and rating using `GET /api/reviews/worker/:workerId`.

## 6. Employer Experience (Dashboard, Posting, Selection)

**What it does**  
Allows employers to:
- Post new jobs
- View and filter their job postings
- Manage candidate selection and job lifecycle

**Why it’s important**  
If employers can’t easily manage their jobs, they churn quickly; employer UX is key to job supply.

**How it works (high level)**  
- Employer dashboard (`/dashboard/employer`):
  - Confirms role via `GET /api/users/me`.
  - Lists jobs with `GET /api/jobs/my`, filtered by status (Tất cả, Đang đăng, Đang bàn giao, Đã hoàn thành).
- Post job (`/jobs/new`):
  - `POST /api/jobs` with `title`, `description`, `price`, `address`, `requiredSkill`.
  - On success, redirects to `/jobs/:jobId`.
- Manage job applications and status (as in section 4) from job detail.

## 7. Complaints & Admin Resolution

**What it does**  
Lets employers and workers file complaints for problematic jobs, and gives admins tools to resolve them.

**Why it’s important**  
Dispute resolution builds trust and enables safe usage at scale.

**How it works (high level)**  
- Filing complaints:
  - Entry from job detail or dashboards.
  - `POST /api/complaints` with `jobId`, `targetUserId`, `type`, `description`, optional `evidenceUrls`.
  - `GET /api/complaints/my` to list user’s complaints and statuses.
- Admin resolution:
  - Admin dashboard fetches `GET /api/admin/complaints/pending` (or equivalent).
  - Resolves via `POST /api/admin/complaints/:id/resolve` with resolution status and note.
  - Notifications are sent via notifications module (see next).

## 8. Notifications

**What it does**  
Surfaces key events (applications received, application accepted/rejected, certificate decisions, complaint updates, job expiries) in a central notification center and header badge.

**Why it’s important**  
Keeps users engaged and informed without forcing them to constantly poll pages.

**How it works (high level)**  
- Notification bell in header uses:
  - `GET /api/notifications` and counts `!isRead` items for badge.
- Notifications page (`/notifications`):
  - Lists notifications from the same endpoint, grouped by date and type.
- Mark as read:
  - `POST /api/notifications/:id/read` on click.
  - UI optimistically toggles read state and decrements badge.

## 9. System Tasks & Health

**What it does**  
Reflects system‑driven changes (e.g., jobs auto‑expired after handover deadline) and exposes a health check.

**Why it’s important**  
Ensures users understand automatic state changes, and gives ops minimal visibility into system health.

**How it works (high level)**  
- Job cards and detail read `status` and `handoverDeadline` from job APIs; when backend’s `/api/system/jobs/expire-handover` updates jobs, frontend simply displays new statuses (e.g., “Quá hạn bàn giao”).
- Optional health page uses `GET /health` to show backend status.

---

# User Experience

## Personas

- **Employer (Nhà tuyển dụng)**
  - Needs trustworthy workers for repair/maintenance.
  - Values speed, clarity of pricing, ability to compare candidates and see ratings.
  - Typically posts jobs occasionally, needs simple flows.

- **Worker (Người lao động)**
  - Seeks a steady stream of local jobs matching their skills.
  - Cares about clear job descriptions, fair pricing, and building a strong rating/verification profile.

- **Admin**
  - Monitors platform quality, resolves disputes, verifies workers, and possibly moderates job postings.

## Key User Flows

1. **Worker: Discover and apply to a job**
   - Land on home `/` → use hero search or go to `/jobs`.
   - Filter by skill/area; view cards.
   - Open job detail `/jobs/[id]`.
   - Click `Ứng tuyển ngay` → `POST /api/jobs/:jobId/apply`.
   - See confirmation; later receive notification when accepted/rejected.

2. **Employer: Post a job and choose a worker**
   - Log in/register as employer.
   - Go to `/jobs/new`, fill in form, submit `POST /api/jobs`.
   - View job detail; wait for applications.
   - In `Danh sách ứng viên`, inspect candidates (skills, ratings).
   - Accept one via `POST /api/applications/:applicationId/accept`.
   - When work is done, mark job as completed via `POST /api/jobs/:jobId/complete`.

3. **Worker: Get verified with certificates**
   - Go to `/certificates`.
   - See `isVerified` flag and existing certificates from `GET /api/workers/certificates/status`.
   - Upload a new certificate (image URL) via `POST /api/workers/certificates`.
   - Later get notification when admin approves; verification badge appears.

4. **Employer: Review a worker**
   - On a completed job where a worker was accepted, see `Đánh giá thợ`.
   - Open review modal, submit `POST /api/reviews` with rating/comment.
   - Worker’s rating updates on worker profile and future job candidate lists.

5. **Complaint and resolution**
   - User files complaint from job detail using `POST /api/complaints`.
   - Tracks status in `/complaints` using `GET /api/complaints/my`.
   - Admin processes via admin dashboard and resolves with `POST /api/admin/complaints/:id/resolve`.
   - Users receive notification and can see resolution.

## UI/UX Considerations

- **Mobile‑first, responsive design** with layouts similar to Chợ Tốt’s card grids and sticky header.
- **Consistent component library** for inputs, buttons, modals, tabs, and skeletons.
- **Clear mapping of backend errors to UI**:
  - Show precise, human‑readable messages for business rule violations.
  - Use consistent toasts for global errors, inline messages for form errors.
- **Role‑aware navigation**:
  - Hide or disable employer‑only actions for workers and vice versa.
- **State clarity**:
  - Job status, application status, complaint status, certificate status all use badges with color and text.

---

# Technical Architecture

## System Components

- **Frontend app**: Next.js (App Router) + React + TypeScript + TailwindCSS.
  - Routing and layouts in `src/app`.
  - Reusable UI components in `src/components`.
  - Shared logic and API clients in `src/lib`.
- **Backend API**: Existing Node.js + Express + SQLite stack.
  - Provides REST endpoints under `/api/*` plus `/health`.
- **Auth & storage**:
  - JWT access token stored in `localStorage` (MVP) and attached to API requests via a shared HTTP client.
  - Consider secure cookies for future hardening.

## Data Models (Frontend View)

- `AuthUser`: mirrors backend user object (`id`, `phone`, `fullName`, `address`, `role`, `createdAt`).
- `Job`: id, employerId, title, description, price, address, requiredSkill, status, acceptedWorkerId, handoverDeadline, createdAt, updatedAt.
- `Application`: id, jobId, workerId, status, createdAt, worker info.
- `Review`: id, jobId, employer, rating, comment, createdAt.
- `Certificate`: id, workerId, imageUrl, status, reviewedBy, reviewedAt.
- `Complaint`: id, jobId, complainantId, targetUserId, type, status, resolution, createdAt.
- `Notification`: id, userId, type, title, body, isRead, createdAt, metadata (links to job/application/complaint).

## APIs & Integrations

The frontend uses the following API groupings (from `lib/api/*.ts`):

- `auth.ts`: registration and login endpoints.
- `users.ts`: `GET/PUT /api/users/me`.
- `jobs.ts`: `GET /api/jobs`, `GET /api/jobs/my`, `POST/PUT/DELETE /api/jobs/:id`, job status actions.
- `applications.ts`: apply to job, list worker applications, list job applications, accept/reject.
- `certificates.ts`: worker certificate status, create; admin certificate approval/rejection.
- `reviews.ts`: create review, list worker reviews.
- `complaints.ts`: create complaint, list my complaints; admin resolve.
- `admin.ts`: admin‑only views over jobs/certificates/complaints.
- `notifications.ts`: list and mark notifications.
- `system.ts`: health and (optional) system task triggers.

Each API function wraps `apiGet/apiPost/apiPatch/apiDelete` and returns typed data for components.

## Infrastructure Requirements

- Frontend:
  - Hosted as static + server components (Next.js), e.g. Vercel or similar.
  - Environment variables (API base URL, etc.).
- Backend:
  - Already deployed or running locally at a known base URL; CORS configured to allow frontend origin.

---

# Development Roadmap

## Phase 1 – Foundation & Auth (MVP)

- Set up Next.js + TS + Tailwind project with base layout (`layout.tsx`, `Header`, `Footer`).
- Implement shared HTTP client and auth store (`useAuth`, `lib/api/http.ts`).
- Implement:
  - Login page and forms (`/login`).
  - Employer and worker registration pages (`/register/employer`, `/register/worker`).
  - `GET /api/users/me` integration and role‑aware header.

## Phase 2 – Jobs Discovery & Detail (MVP)

- Implement home page with hero + search bar integrated with `GET /api/jobs`.
- Implement `/jobs` listing page with filters (q, skill, city/district, status, sort, page/limit).
- Implement job detail page `/jobs/[id]`:
  - Show job info from `GET /api/jobs/:jobId`.
  - Worker `Ứng tuyển` button using `POST /api/jobs/:jobId/apply`.

## Phase 3 – Dashboards & Core Role Flows

- Employer dashboard:
  - `/dashboard/employer` using `GET /api/jobs/my`.
  - Job creation `/jobs/new` using `POST /api/jobs`.
  - Applications management for a job (`GET /api/jobs/:jobId/applications`, accept/reject).
- Worker dashboard:
  - `/dashboard/worker` using `GET /api/applications/my` and `GET /api/reviews/worker/:workerId`.
- Profile editing `/profile` (update current user).

## Phase 4 – Certificates, Reviews, Complaints

- Certificates:
  - Worker cert status page using `GET /api/workers/certificates/status`.
  - Upload new cert with `POST /api/workers/certificates`.
- Reviews:
  - Review form on completed job: `POST /api/reviews`.
  - Worker profile view `/workers/[id]` using `GET /api/reviews/worker/:workerId`.
- Complaints:
  - Complaint form `POST /api/complaints` from job pages.
  - Complaints list `/complaints` via `GET /api/complaints/my`.

## Phase 5 – Admin Tools & Notifications

- Admin dashboard:
  - Complaints tab (`GET /api/admin/complaints/pending`, `POST /api/admin/complaints/:id/resolve`).
  - Certificates tab (`GET /api/admin/certificates/pending`, approve/reject).
  - (Optional) Jobs tab if job approvals are needed.
- Notifications:
  - Header bell + count via `GET /api/notifications`.
  - Notifications page `/notifications`.
  - Mark as read via `POST /api/notifications/:id/read`.

## Phase 6 – Polish & UX Enhancements

- Better error handling, skeletons, and empty states across all pages.
- SEO improvements for public pages.
- Accessibility checks and small UI refinements inspired by Chợ Tốt’s patterns.

---

# Logical Dependency Chain

1. **Core Setup & Auth**
   - Must exist before any role‑based dashboards or protected routes.
   - Includes HTTP client, auth store, basic routing, and header.
2. **Jobs Listing & Detail**
   - Built next to quickly surface something “real” and test backend integration.
   - Enables immediate value: workers can at least view jobs even before full dashboards are ready.
3. **Dashboards (Employer & Worker)**
   - Depend on auth and job listing; provide personalized views on top of the same data.
4. **Applications & Status Management**
   - Extends job detail and dashboards to complete the core “match” flow.
5. **Certificates, Reviews, and Complaints**
   - Layered on top of stable job and application flows.
   - They enhance trust, quality, and dispute resolution but are logically after matching is functional.
6. **Admin Tools & Notifications**
   - Depend on previous features to have data to operate on.
   - Provide moderation, trust signals, and engagement.
7. **System / Health & Polish**
   - Support and refine everything built before.

This ordering ensures we reach a “usable frontend” quickly (search + job detail + apply/post) and then layer in quality, trust, and admin controls.

---

# Risks and Mitigations

## Technical Challenges

- **Keeping frontend types in sync with backend responses**
  - *Risk*: Backend schema changes could break frontend silently.
  - *Mitigation*: Centralize type definitions in `lib/types`, keep them close to Swagger/OpenAPI spec, and update them whenever backend tests or swagger change.

- **Auth handling and token expiry**
  - *Risk*: Inconsistent handling of 401 can lead to confusing UX.
  - *Mitigation*: Use a single HTTP client with a 401 interceptor that clears state and redirects with a clear toast.

- **Complex business rules around job applications and status**
  - *Risk*: Frontend might present actions that backend forbids, causing many error popups.
  - *Mitigation*: Reflect core rules in UI (disable/hidden buttons when possible), but always surface backend `error` string clearly.

## MVP Scope Clarity

- *Risk*: Over‑designing UX or admin tooling before core job posting/matching is solid.
  - *Mitigation*: Follow the roadmap / dependency chain strictly; do not start admin panels or complaints until matching flows are working end‑to‑end.

## Resource Constraints

- *Risk*: Limited time/people to implement full Chợ Tốt‑style UX.
  - *Mitigation*: Use a component library and basic Tailwind utility patterns; start with a simple but clean UI and iterate later on advanced filters, animations, and personalization.

---

# Appendix

## Research & Inspiration

- Frontend UX and card layout patterns are inspired by `[chotot.com](https://www.chotot.com/)`:
  - Sticky header with main categories and quick actions.
  - Hero search bar with “Danh mục” and “Chọn khu vực”.
  - Grid‑based card layout with status badges and relative time.

## Technical Specifications (Summary)

- **Stack**: Next.js (App Router), React, TypeScript, TailwindCSS.
- **API Base**: Existing Express backend, using JSON over HTTP with JWT auth.
- **Routing**:
  - Public: `/`, `/jobs`, `/jobs/[id]`, `/workers/[id]`, `/login`, `/register/*`.
  - Protected worker: `/dashboard/worker`, `/certificates`, `/complaints`, `/notifications`.
  - Protected employer: `/dashboard/employer`, `/jobs/new`, employer job management.
  - Protected admin: `/dashboard/admin/*`.
- **State management**: lightweight hooks (`useAuth`, `useJobsSearch`, `useNotifications`) plus React context where needed.

This PRD is the single source of truth for the FixingApp frontend: it ties together UX, project structure, and backend API usage into a coherent plan ready to be split into implementation tasks.

